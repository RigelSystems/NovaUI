import{h as q,d as R,H as U}from"./index-CENpTiMW.js";import{d as re,u as d,g as G,w as oe,x as le,o as r,b as o,B as M,C as ue,m as u,f as S,t as i,F as v,p as y,n as V,j as de,D as ie}from"./vue.esm-bundler-C_Ws3nPw.js";import{_ as ce}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./decorators-Bnaor6Ku.js";const Q=re({name:"NDataGrid",props:{url:{type:String,required:!0},method:{type:String,default:"GET"},params:{type:Object,default:()=>({})},accessToken:{type:String,default:""},search:{type:Boolean,default:!1},sortable:{type:Boolean,default:!1},pageSize:{type:Number,default:10},searchableFields:{type:Array,default:()=>[]},sortableFields:{type:Array,default:()=>[]}},setup(e){const n=d(!0),w=d([]),N=d([]),C=d(null),b=d(""),a=d(1),l=d(1),m=d(0),k=d(e.pageSize),g=d(null),f=d("asc"),D=d(null),J=[10,25,50,100],K=G(()=>{const t=[];if(l.value<=5)for(let s=1;s<=l.value;s++)t.push(s);else if(a.value<=3){for(let s=1;s<=4;s++)t.push(s);t.push("..."),t.push(l.value)}else if(a.value>=l.value-2){t.push(1),t.push("...");for(let s=l.value-3;s<=l.value;s++)t.push(s)}else{t.push(1),t.push("...");for(let s=a.value-1;s<=a.value+1;s++)t.push(s);t.push("..."),t.push(l.value)}return t}),W=G(()=>(a.value-1)*k.value+1),X=G(()=>Math.min(a.value*k.value,m.value)),Y=()=>{const t={...e.params,page:{number:a.value,size:k.value}};if(e.search&&b.value&&e.searchableFields.length>0){const p=e.searchableFields.reduce((s,h)=>(s[`${h}_cont`]=b.value,s),{});t.q={m:"or",...p}}return e.sortable&&g.value&&(t.sort=f.value==="desc"?`${g.value} desc`:g.value),t},c=async()=>{try{n.value=!0;const t=Y(),p=new URL(e.url);e.method==="GET"&&Object.entries(t).forEach(([$,E])=>{typeof E=="object"?Object.entries(E).forEach(([se,ne])=>{p.searchParams.append(`${$}[${se}]`,String(ne))}):p.searchParams.append($,String(E))});const s=await fetch(p.toString(),{method:e.method,headers:{"Content-Type":"application/json",...e.accessToken?{Authorization:`Bearer ${e.accessToken}`}:{}},...e.method==="POST"?{body:JSON.stringify(t)}:{}});if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const h=await s.json();w.value=h.headers,N.value=h.data,m.value=h.meta.total,l.value=h.meta.total_pages}catch(t){C.value="Failed to fetch data",console.error(t)}finally{n.value=!1}},Z=()=>{D.value&&clearTimeout(D.value),D.value=window.setTimeout(()=>{a.value=1,c()},300)},x=t=>{e.sortableFields.includes(t)&&(g.value===t?f.value=f.value==="asc"?"desc":"asc":(g.value=t,f.value="asc"),c())},ee=t=>e.sortableFields.includes(t)?g.value!==t?"↕":f.value==="asc"?"↑":"↓":"",ae=t=>{a.value=t,c()},te=()=>{a.value=1,c()};return oe(()=>e.params,()=>{a.value=1,c()},{deep:!0}),le(()=>{c()}),{errorMessage:C,loading:n,headers:w,data:N,searchQuery:b,currentPage:a,totalPages:l,totalItems:m,pageSize:k,pageSizeOptions:J,displayedPages:K,startItem:W,endItem:X,handleSearch:Z,handleSort:x,getSortIcon:ee,changePage:ae,handlePageSizeChange:te,fetchData:c}}}),me={class:"n-data-grid"},ge={key:0,class:"n-data-grid__search"},pe={key:1,class:"n-data-grid__loading"},he={key:2,class:"n-data-grid__loading"},ve={key:3,class:"n-data-grid__table"},fe=["onClick"],ye={key:0,class:"sort-icon"},be=["innerHTML"],ke={key:4,class:"n-data-grid__pagination"},Se={class:"n-data-grid__pagination-controls"},Pe=["disabled"],_e=["disabled"],Te={class:"n-data-grid__page-numbers"},we=["onClick"],Ne={key:1,class:"n-data-grid__page-ellipsis"},Ce=["disabled"],De=["disabled"],Ee={class:"n-data-grid__pagination-info"},Ge=["value"];function $e(e,n,w,N,C,b){return r(),o("div",me,[e.search?(r(),o("div",ge,[M(u("input",{type:"text","onUpdate:modelValue":n[0]||(n[0]=a=>e.searchQuery=a),placeholder:"Search...",onInput:n[1]||(n[1]=(...a)=>e.handleSearch&&e.handleSearch(...a)),class:"n-data-grid__search-input"},null,544),[[ue,e.searchQuery]])])):S("",!0),e.loading?(r(),o("div",pe,"Loading...")):S("",!0),e.errorMessage?(r(),o("div",he,i(e.errorMessage),1)):(r(),o("table",ve,[u("thead",null,[u("tr",null,[(r(!0),o(v,null,y(e.headers,a=>(r(),o("th",{key:a,onClick:l=>e.sortable?e.handleSort(a):null,class:V({sortable:e.sortable})},[de(i(a)+" ",1),e.sortable?(r(),o("span",ye,i(e.getSortIcon(a)),1)):S("",!0)],10,fe))),128))])]),u("tbody",null,[(r(!0),o(v,null,y(e.data,(a,l)=>(r(),o("tr",{key:l},[(r(!0),o(v,null,y(e.headers,m=>(r(),o("td",{key:m,innerHTML:a[m]},null,8,be))),128))]))),128))])])),e.totalPages>1?(r(),o("div",ke,[u("div",Se,[u("button",{disabled:e.currentPage===1,onClick:n[2]||(n[2]=a=>e.changePage(1)),class:"n-data-grid__pagination-button"}," First ",8,Pe),u("button",{disabled:e.currentPage===1,onClick:n[3]||(n[3]=a=>e.changePage(e.currentPage-1)),class:"n-data-grid__pagination-button"}," Previous ",8,_e),u("div",Te,[(r(!0),o(v,null,y(e.displayedPages,a=>(r(),o(v,{key:a},[a!=="..."?(r(),o("button",{key:0,onClick:l=>e.changePage(a),class:V(["n-data-grid__page-number",{active:a===e.currentPage}])},i(a),11,we)):(r(),o("span",Ne,"..."))],64))),128))]),u("button",{disabled:e.currentPage===e.totalPages,onClick:n[4]||(n[4]=a=>e.changePage(e.currentPage+1)),class:"n-data-grid__pagination-button"}," Next ",8,Ce),u("button",{disabled:e.currentPage===e.totalPages,onClick:n[5]||(n[5]=a=>e.changePage(e.totalPages)),class:"n-data-grid__pagination-button"}," Last ",8,De)]),u("div",Ee,[u("span",null,"Showing "+i(e.startItem)+" to "+i(e.endItem)+" of "+i(e.totalItems)+" entries",1),M(u("select",{"onUpdate:modelValue":n[6]||(n[6]=a=>e.pageSize=a),onChange:n[7]||(n[7]=(...a)=>e.handlePageSizeChange&&e.handlePageSizeChange(...a)),class:"n-data-grid__page-size-select"},[(r(!0),o(v,null,y(e.pageSizeOptions,a=>(r(),o("option",{key:a,value:a},i(a)+" per page ",9,Ge))),128))],544),[[ie,e.pageSize]])])])):S("",!0)])}const Me=ce(Q,[["render",$e],["__scopeId","data-v-0c824dae"]]);Q.__docgenInfo={displayName:"NDataGrid",exportName:"default",description:"",tags:{},props:[{name:"url",type:{name:"string"},required:!0},{name:"method",values:["GET","POST"],type:{name:"string"},defaultValue:{func:!1,value:"'GET'"}},{name:"params",type:{name:"Record<string, any>"},defaultValue:{func:!0,value:"() => ({})"}},{name:"accessToken",type:{name:"string"},defaultValue:{func:!1,value:"''"}},{name:"search",type:{name:"boolean"},defaultValue:{func:!1,value:"false"}},{name:"sortable",type:{name:"boolean"},defaultValue:{func:!1,value:"false"}},{name:"pageSize",type:{name:"number"},defaultValue:{func:!1,value:"10"}},{name:"searchableFields",type:{name:"string[]"},defaultValue:{func:!0,value:"() => []"}},{name:"sortableFields",type:{name:"string[]"},defaultValue:{func:!0,value:"() => []"}}],sourceFiles:["/home/runner/work/NovaUI/NovaUI/src/stories/NDataGrid/NDataGrid.vue"]};const Oe={component:Me,title:"Data/NDataGrid"},P={args:{url:"/mock/data",method:"GET",params:{}}},Ve={headers:["Name","Age"],data:[{Name:"Alex",Age:28},{Name:"Sam",Age:35},{Name:"Taylor",Age:24}]},_={args:{url:"/mock/data",method:"GET",params:{}},parameters:{msw:{handlers:[q.get("/mock/data",async()=>(await R(500),U.json(Ve)))]}}},T={args:{url:"/mock/data",method:"GET",params:{}},parameters:{msw:{handlers:[q.get("/mock/data",async()=>(await R(500),new U(null,{status:403})))]}}};var F,z,I;P.parameters={...P.parameters,docs:{...(F=P.parameters)==null?void 0:F.docs,source:{originalSource:`{
  args: {
    url: '/mock/data',
    method: 'GET',
    params: {}
  }
}`,...(I=(z=P.parameters)==null?void 0:z.docs)==null?void 0:I.source}}};var j,O,A;_.parameters={..._.parameters,docs:{...(j=_.parameters)==null?void 0:j.docs,source:{originalSource:`{
  args: {
    url: '/mock/data',
    method: 'GET',
    params: {}
  },
  parameters: {
    msw: {
      handlers: [http.get('/mock/data', async () => {
        await delay(500); // simulate loading delay
        return HttpResponse.json(MockData);
      })]
    }
  }
}`,...(A=(O=_.parameters)==null?void 0:O.docs)==null?void 0:A.source}}};var B,H,L;T.parameters={...T.parameters,docs:{...(B=T.parameters)==null?void 0:B.docs,source:{originalSource:`{
  args: {
    url: '/mock/data',
    method: 'GET',
    params: {}
  },
  parameters: {
    msw: {
      handlers: [http.get('/mock/data', async () => {
        await delay(500);
        return new HttpResponse(null, {
          status: 403
        });
      })]
    }
  }
}`,...(L=(H=T.parameters)==null?void 0:H.docs)==null?void 0:L.source}}};const Ae=["Default","MockedSuccess","MockedError"];export{P as Default,T as MockedError,_ as MockedSuccess,Ae as __namedExportsOrder,Oe as default};
