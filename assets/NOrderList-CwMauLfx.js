import{d as N,b as c,k as D,w as b,e as i,f as g,j as k,F as S,l as q,n as p,o as u,g as T,m as K}from"./vue.esm-bundler-DjLMENKV.js";import{_ as O}from"./_plugin-vue_export-helper-DlAUqK2U.js";const f=N({name:"NOrderList",props:{items:{type:Array,required:!0},orderKey:{type:String,default:"position"},updateUrl:{type:String,required:!0},loading:{type:Boolean,default:!1},modelName:{type:String,required:!0},accessToken:{type:String,required:!1}},setup(e){const t=c([...e.items]);let d=c(null);const m=D(()=>[...t.value].sort((a,n)=>(a[e.orderKey]??0)-(n[e.orderKey]??0)));return b(()=>e.items,a=>{t.value=[...a]},{deep:!0,immediate:!0}),{sortedItems:m,onDragStart:(a,n)=>{var s;d.value=n;const r=document.createElement("div");r.style.width="1px",r.style.height="1px",r.style.opacity="0",document.body.appendChild(r),(s=a.dataTransfer)==null||s.setDragImage(r,0,0),setTimeout(()=>document.body.removeChild(r),0)},onDrop:async a=>{console.log("dropped");const n=t.value.map(r=>({id:r.id,[e.orderKey]:r[e.orderKey]}));try{const r={"Content-Type":"application/json"};e.accessToken&&(r.Authorization=`Bearer ${e.accessToken}`),await fetch(e.updateUrl,{method:"POST",headers:r,body:JSON.stringify({[e.modelName]:n})})}catch(r){console.error("Failed to update order:",r)}finally{d.value=null}},reorder:(a,n)=>{if(a.preventDefault(),e.loading||d.value===null)return;const r=t.value.findIndex(l=>l.id===d.value),s=t.value.findIndex(l=>l.id===n);if(r===-1||s===-1||r===s)return;const[I]=t.value.splice(r,1);t.value.splice(s,0,I),t.value.forEach((l,h)=>{l[e.orderKey]=h+1})},draggedId:d}}}),_={class:"list-container"},$={key:0,class:"loading-overlay"},C=["aria-disabled","onDragstart","onDragover","onDrop"];function L(e,t,d,m,y,v){return u(),i("div",_,[e.loading?(u(),i("div",$,t[0]||(t[0]=[g("p",null,"Loading...",-1)]))):k("",!0),g("ul",{role:"list",class:p({disabled:e.loading})},[(u(!0),i(S,null,q(e.sortedItems,o=>(u(),i("li",{key:o.id,class:p("list-item "+(o.id==e.draggedId?"dragging":"")),role:"listitem",draggable:"true","aria-disabled":e.loading,onDragstart:a=>e.loading?null:e.onDragStart(a,o.id),onDragover:a=>e.reorder(a,o.id),onDrop:a=>e.loading?null:e.onDrop(o.id)},[T(e.$slots,"default",K({ref_for:!0},o),void 0,!0)],42,C))),128))],2)])}const U=O(f,[["render",L],["__scopeId","data-v-1eb108c9"]]);f.__docgenInfo={displayName:"NOrderList",exportName:"default",description:"",tags:{},props:[{name:"items",type:{name:"Array as () => OrderItem[]"},required:!0},{name:"orderKey",type:{name:"string"},defaultValue:{func:!1,value:"'position'"}},{name:"updateUrl",type:{name:"string"},required:!0},{name:"loading",type:{name:"boolean"},defaultValue:{func:!1,value:"false"}},{name:"modelName",type:{name:"string"},required:!0},{name:"accessToken",type:{name:"string"},required:!1}],slots:[{name:"default",scoped:!0,bindings:[]}],sourceFiles:["/home/runner/work/NovaUI/NovaUI/src/stories/lists/order-list/NOrderList.vue"]};export{U as N};
